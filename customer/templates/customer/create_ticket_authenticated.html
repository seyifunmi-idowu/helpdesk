{% extends 'customer/customer_base.html' %}
{% load static %}

{% block title %}Create New Ticket{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Applied modern card styling with gradient header -->
            <div class="card border-0 shadow-lg">
                <div class="card-header text-white position-relative overflow-hidden" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none;">
                    <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10" style="background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');"></div>
                    <div class="position-relative">
                        <h3 class="card-title mb-0 fw-bold">
                            <i class="fas fa-plus-circle me-2"></i>Create New Ticket
                        </h3>
                        <p class="mb-0 mt-1 opacity-90">Submit your support request and we'll get back to you soon</p>
                    </div>
                </div>

                <div class="card-body p-4">
                    {% if messages %}
                        <div class="mb-4">
                            {% for message in messages %}
                                <!-- Enhanced alert styling -->
                                <div class="alert alert-{{ message.tags }} alert-dismissible fade show border-0 shadow-sm" role="alert" style="border-left: 4px solid {% if message.tags == 'success' %}#28a745{% elif message.tags == 'error' %}#dc3545{% else %}#17a2b8{% endif %} !important;">
                                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-triangle{% else %}info-circle{% endif %} me-2"></i>
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <!-- Added modern form styling with enhanced controls -->
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        {# Exclude email field as it's pre-filled by authenticated user #}
                        {% for field in form %}
                            {% if field.name != 'email' %}
                                <div class="mb-4">
                                    <label for="{{ field.id_for_label }}" class="form-label fw-semibold text-dark mb-2">
                                        {{ field.label }}
                                        {% if field.field.required %}
                                            <span class="text-danger">*</span>
                                        {% endif %}
                                    </label>

                                    {% if field.name == 'subject' %}
                                        <input type="text" class="form-control form-control-lg border-2 shadow-sm"
                                               id="{{ field.id_for_label }}"
                                               name="{{ field.name }}"
                                               value="{{ field.value|default:'' }}"
                                               placeholder="Brief description of your issue"
                                               style="border-color: #e3e6f0; transition: all 0.3s ease; font-size: 1rem;"
                                               onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 0.2rem rgba(102, 126, 234, 0.25)'"
                                               onblur="this.style.borderColor='#e3e6f0'; this.style.boxShadow='none'">
                                    {% elif field.name == 'priority' %}
                                        <select class="form-select form-select-lg border-2 shadow-sm"
                                                id="{{ field.id_for_label }}"
                                                name="{{ field.name }}"
                                                style="border-color: #e3e6f0; transition: all 0.3s ease; font-size: 1rem;"
                                                onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 0.2rem rgba(102, 126, 234, 0.25)'"
                                                onblur="this.style.borderColor='#e3e6f0'; this.style.boxShadow='none'">
                                            {% for choice in field.field.choices %}
                                                <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>{{ choice.1 }}</option>
                                            {% endfor %}
                                        </select>
                                    {% elif field.name == 'description' %}
                                        <textarea class="form-control border-2 shadow-sm"
                                                  id="{{ field.id_for_label }}"
                                                  name="{{ field.name }}"
                                                  rows="6"
                                                  placeholder="Please provide detailed information about your issue..."
                                                  style="border-color: #e3e6f0; transition: all 0.3s ease; resize: vertical; font-size: 1rem;"
                                                  onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 0.2rem rgba(102, 126, 234, 0.25)'"
                                                  onblur="this.style.borderColor='#e3e6f0'; this.style.boxShadow='none'">{{ field.value|default:'' }}</textarea>
                                    {% else %}
                                        {{ field }}
                                    {% endif %}

                                    {% if field.help_text %}
                                        <div class="form-text text-muted mt-1">
                                            <i class="fas fa-info-circle me-1"></i>{{ field.help_text }}
                                        </div>
                                    {% endif %}
                                    {% if field.errors %}
                                        {% for error in field.errors %}
                                            <div class="text-danger mt-1">
                                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                            </div>
                                        {% endfor %}
                                    {% endif %}
                                </div>
                            {% endif %}
                        {% endfor %}

                        <!-- Enhanced submit button with loading state -->
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-lg text-white fw-semibold py-3 border-0 shadow-sm position-relative overflow-hidden"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: all 0.3s ease;"
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.3)'"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.2)'"
                                    onclick="this.innerHTML='<i class=\'fas fa-spinner fa-spin me-2\'></i>Submitting Ticket...'; this.disabled=true;">
                                <i class="fas fa-paper-plane me-2"></i>Submit Ticket
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Added custom styles for enhanced form interactions */
.form-control:focus,
.form-select:focus {
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.btn:focus {
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25) !important;
}

.alert {
    border-radius: 10px;
}

.card {
    border-radius: 15px;
}

.card-header {
    border-radius: 15px 15px 0 0 !important;
}
</style>
{% endblock %}
