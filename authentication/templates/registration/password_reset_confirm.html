{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UV DESK | Set New Password</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
</head>
<body class="hold-transition login-page">
<div class="login-box">
  <!-- /.login-logo -->
  <div class="card card-outline card-primary">
    <div class="card-header text-center">
      <a href="#" class="h1"><b>UV</b> DESK</a> {# Link to dashboard might not be appropriate here #}
    </div>
<div class="card-body">
                    <p class="login-box-msg">Enter your new password below.</p>

                    {% if form.errors %}
                    <div class="alert alert-danger">
                        {% for field in form %}
                            {% for error in field.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        {% endfor %}
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <form method="post">
                        {% csrf_token %}

                        <div class="form-group">
                            <label for="new_password1">New Password</label>
                            <div class="input-group mb-3">
                                <input type="password"
                                       name="new_password1"
                                       id="new_password1"
                                       class="form-control"
                                       placeholder="Enter new password"
                                       required>
                                <div class="input-group-append">
                                    <div class="input-group-text">
                                        <span class="fas fa-lock"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="password-strength-meter mt-1 mb-3">
                                <div class="progress" style="height: 5px;">
                                    <div class="progress-bar" role="progressbar" style="width: 0%;"></div>
                                </div>
                                <small class="text-muted">Password strength: <span class="strength-label">None</span></small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="new_password2">Confirm Password</label>
                            <div class="input-group mb-3">
                                <input type="password"
                                       name="new_password2"
                                       id="new_password2"
                                       class="form-control"
                                       placeholder="Confirm new password"
                                       required>
                                <div class="input-group-append">
                                    <div class="input-group-text">
                                        <span class="fas fa-lock"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group form-check mb-3">
                            <input type="checkbox" class="form-check-input" id="showPassword">
                            <label class="form-check-label" for="showPassword">Show passwords</label>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-block">Set password</button>
                            </div>
                        </div>
                    </form>
                </div>    <!-- /.card-body -->
  </div>
  <!-- /.card -->
</div>
<style>
.password-strength-meter {
    margin-top: 0.5rem;
}
.progress {
    background-color: #f1f1f1;
}
.strength-weak .progress-bar { background-color: #dc3545; }
.strength-medium .progress-bar { background-color: #ffc107; }
.strength-strong .progress-bar { background-color: #28a745; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('new_password1');
    const confirmInput = document.getElementById('new_password2');
    const showPasswordCheckbox = document.getElementById('showPassword');
    const progressBar = document.querySelector('.progress-bar');
    const strengthLabel = document.querySelector('.strength-label');
    const meterContainer = document.querySelector('.password-strength-meter');

    // Toggle password visibility
    showPasswordCheckbox.addEventListener('change', function() {
        const type = this.checked ? 'text' : 'password';
        passwordInput.type = type;
        confirmInput.type = type;
    });

    // Password strength meter
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;

        // Length check
        if (password.length >= 8) strength += 1;

        // Contains lowercase, uppercase, numbers, special characters
        if (password.match(/[a-z]+/)) strength += 1;
        if (password.match(/[A-Z]+/)) strength += 1;
        if (password.match(/[0-9]+/)) strength += 1;
        if (password.match(/[!@#$%^&*(),.?":{}|<>]/)) strength += 1;

        // Update progress bar and label
        let width = 0;
        let strengthText = '';
        let strengthClass = '';

        switch(strength) {
            case 0:
            case 1:
                width = 25;
                strengthText = 'Weak';
                strengthClass = 'strength-weak';
                break;
            case 2:
            case 3:
                width = 50;
                strengthText = 'Medium';
                strengthClass = 'strength-medium';
                break;
            case 4:
                width = 75;
                strengthText = 'Strong';
                strengthClass = 'strength-strong';
                break;
            case 5:
                width = 100;
                strengthText = 'Very Strong';
                strengthClass = 'strength-strong';
                break;
        }

        progressBar.style.width = width + '%';
        strengthLabel.textContent = strengthText;

        // Update classes
        meterContainer.classList.remove('strength-weak', 'strength-medium', 'strength-strong');
        meterContainer.classList.add(strengthClass);
    });
});
</script>

<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'dist/js/adminlte.min.js' %}"></script>
</body>
</html>
